<div class='mx-auto container'>
    <div class="container"><h3>Orders</h3></div>
    {{#each orders}}
    <div class='row my-3'>
        <div class='container-fluid border rounded p-4'>
            <div class="row">
                <div class="col-5">
                    <span class='orderno' data-value='{{this._id}}'>ORDER NUMBER <h5>{{this._id}}</h5></span>
                    <span class='font-weight-bold'>{{this.buyername}}</span> - <span>{{this.status}}</span> <br>
                    <span>+63 917 123 4567 - {{this.buyer}}</span> <br>
                    <span>123 Main St., Manila City, Metro Manila</span>
                    <br><br>
                    <span class='font-weight-bold'>DATE ORDERED:</span> {{this.date_of_order}} <br>
                    <span class='font-weight-bold'>DATE DELIVERED:</span> {{this.date_of_deliver}}
                    <br><br>
                    <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Change Status</button>
                    <div class="dropdown-menu">
                        <a class="dropdown-item changestatus" data-value='Active'>Active</a>
                        <a class="dropdown-item changestatus" data-value='Hold'>Hold</a>
                        <a class="dropdown-item changestatus" data-value='Cancelled'>Cancelled</a>
                        <a class="dropdown-item changestatus" data-value='Delivered'>Delivered</a>
                    </div>
                </div>

                <div class='col-7'>
                    <table class="table">
                        <col width="180">
                        <col width="30">
                        <thead>
                            <tr>
                                <th>TOTAL</th>
                                <th class="decimal">{{this.total_price}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each this.order_items}}
                            <tr>
                                <td>{{name}} (PHP <span class="price decimal">{{price}}</span> X <span class="quantity decimal">{{quantity}}</span>)</td>
                                <td><span class="total decimal"></span></td>
                            </tr>
                            {{/each}}
                            <tr>
                                <td>Delivery</td>
                                <td>50.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {{/each}}
</div>

<script>
    $(document).ready( function(){

        // breakdown of total: price x quantity

        var arr = $(".total");
        var p;
        var q;
        
        for(i=0; i<arr.length; i++)
        {
            p = $(arr[i]).parent().parent().children().children().filter(".price").text()
            q = $(arr[i]).parent().parent().children().children().filter(".quantity").text()
            //console.log(p)
            $(arr[i]).text("" + p * q)
        }


        // add decimal 
        var decimal = $(".decimal")

        for(i=0; i<decimal.length; i++)
        {
            newValue = $(decimal[i]).text();
            newValue = parseFloat(newValue);
            newValue = newValue.toFixed(2);
            $(decimal[i]).text(newValue);
        }
    })

</script>
