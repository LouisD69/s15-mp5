<div class='mx-auto container'>
    <div class="container"><h3>My Orders</h3></div>
    {{#each activeorders}}
    <div class='row my-3'>
        <div class='container-fluid border border-0 rounded'>
            <div class='row bg-{{this.status}}'>
                &nbsp;
            </div>
            <div class="row pt-4 px-4 bg-light">
                <div class="col-5">
                    <span class='orderno' data-value='{{this._id}}'>ORDER NUMBER <h5>{{this._id}}</h5></span>
                    <span class='font-weight-bold'>{{this.buyername}}</span> - <span>{{this.status}}</span> <br>
                    <span>+63 917 123 4567 - {{this.buyer}}</span> <br>
                    <span>123 Main St., Manila City, Metro Manila</span>
                    <br><br>
                    <span class='font-weight-bold'>DATE ORDERED:</span> {{this.date_of_order}} <br>
                    <span class='font-weight-bold'>DATE DELIVERED:</span> {{this.date_of_deliver}}
                    <br><br>
                </div>

                <div class='col-7'>
                    <table class="table">
                        <col width="180">
                        <col width="30">
                        <thead>
                            <tr>
                                <th>TOTAL</th>
                                <th class='text-right'>PHP <span class='decimal'>{{this.total_price}}</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each this.order_items}}
                            <tr>
                                <td>{{name}} (PHP <span class="price decimal">{{price}}</span> X <span class="quantity decimal">{{quantity}}</span>)</td>
                                <td class='text-right'><span class="total decimal"></span></td>
                            </tr>
                            {{/each}}
                            <tr>
                                <td>Delivery</td>
                                <td class='text-right'>50.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {{/each}}
    <br><br><br>
    <div class="container"><h3>Past Orders</h3></div>
    {{#each pastorders}}
    <div class='row my-5'>
        <div class='container-fluid border border-0 rounded'>
            <div class='row bg-{{this.status}}'>
                &nbsp;
            </div>
            <div class="row pt-4 px-4 bg-light">
                <div class="col-5">
                    <span class='orderno' data-value='{{this._id}}'>ORDER NUMBER <h5>{{this._id}}</h5></span>
                    <span class='font-weight-bold'>{{this.buyername}}</span> - <span>{{this.status}}</span> <br>
                    <span>+63 917 123 4567 - {{this.buyer}}</span> <br>
                    <span>123 Main St., Manila City, Metro Manila</span>
                    <br><br>
                    <span class='font-weight-bold'>DATE ORDERED:</span> {{this.date_of_order}} <br>
                    <span class='font-weight-bold'>DATE DELIVERED:</span> {{this.date_of_deliver}}
                    <br><br>
                </div>

                <div class='col-7'>
                    <table class="table">
                        <col width="180">
                        <col width="30">
                        <thead>
                            <tr>
                                <th>TOTAL</th>
                                <th class='text-right'>PHP <span class='decimal'>{{this.total_price}}</span></th>
                            </tr>
                        </thead>
                        <tbody>
                            {{#each this.order_items}}
                            <tr>
                                <td>{{name}} (PHP <span class="price decimal">{{price}}</span> X <span class="quantity decimal">{{quantity}}</span>)</td>
                                <td class='text-right'><span class="total decimal"></span></td>
                            </tr>
                            {{/each}}
                            <tr>
                                <td>Delivery</td>
                                <td class='text-right'>50.00</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    {{/each}}
</div>

<script>
    $(document).ready( function(){

        // breakdown of total: price x quantity

        var arr = $(".total");
        var p;
        var q;
        
        for(i=0; i<arr.length; i++)
        {
            p = $(arr[i]).parent().parent().children().children().filter(".price").text()
            q = $(arr[i]).parent().parent().children().children().filter(".quantity").text()
            //console.log(p)
            $(arr[i]).text("" + p * q)
        }


        // add decimal 
        var decimal = $(".decimal")

        for(i=0; i<decimal.length; i++)
        {
            newValue = $(decimal[i]).text();
            newValue = parseFloat(newValue);
            newValue = newValue.toFixed(2);
            $(decimal[i]).text(newValue);
        }
    });

    $('.changestatus').click(function () {
        var orderNo = $(this).parent().siblings().filter('.orderno').data('value');
        var newStatus = $(this).data('value');

        $.ajax({
            url: "changeStatus",
            type: 'POST',
            data: {orderNo: orderNo, newStatus: newStatus},
            success: function (data) 
            { 
                console.log(newStatus); 
                window.location.href = "/admin/orders"; 
            },
        });
    });

</script>